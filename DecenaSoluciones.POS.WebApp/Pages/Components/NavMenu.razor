@using BlazorBootstrap
@using DecenaSoluciones.POS.Shared.Dtos
@using DecenaSoluciones.POS.Shared.Extensions
@using DecenaSoluciones.POS.WebApp.Extensions

@inject ILocalStorage _localStorage

<Sidebar @ref="sidebar" ImageSrc="/images/logo/LoginLogo.svg" Title="Decena Soluciones APP"
    DataProvider="SidebarDataProvider" />

@code {
    private Sidebar sidebar = default!;
    private IEnumerable<NavItem> navItems = default!;

    [Parameter]
    public EventCallback OnToggle { get; set; }

    private async Task<SidebarDataProviderResult> SidebarDataProvider(SidebarDataProviderRequest request)
    {
        if (navItems is null)
            navItems = await GetNavItems();

        return await Task.FromResult(request.ApplyTo(navItems));
    }

    private async Task<IEnumerable<NavItem>> GetNavItems()
    {
        var userSession = await _localStorage.GetStorage<UserInfoExtension>("userSession");
        if (userSession == null) return new List<NavItem>();

        if (userSession.IsCompanyCreator)
        {
            navItems = new List<NavItem>
{
new NavItem { Id = "1", Href = "/companies", IconName = IconName.BuildingFillGear, Text = "Compañías" },
new NavItem { Id = "2", Href = "/users", IconName = IconName.FilePersonFill, Text = "Usuarios" }
};
        }
        else
        {
            navItems = new List<NavItem>
{
new NavItem { Id = "1", Href = "/", IconName = IconName.HouseDoorFill, Text = "Inicio", Match = NavLinkMatch.All},
new NavItem { Id = "2", IconName = IconName.CartCheckFill, Text = "Ventas"},
new NavItem { Id = "3", Href = "/newsale", IconName = IconName.Receipt, Text = "Nueva venta", ParentId="2"},
new NavItem { Id = "4", Href = "/sales", IconName = IconName.FolderSymlinkFill, Text = "Reporte ventas", ParentId="2"},
new NavItem { Id = "5", Href = "/quotations", IconName = IconName.FolderSymlinkFill, Text = "Reporte cotizaciones",
ParentId="2"},
new NavItem { Id = "6", IconName = IconName.BoxSeamFill, Text = "Productos"},
new NavItem { Id = "7", Href = "/products", IconName = IconName.Boxes, Text = "Listado de Productos", ParentId="6"},
new NavItem { Id = "8", Href = "/inventory", IconName = IconName.CardChecklist, Text = "Inventario", ParentId="6"},
new NavItem { Id = "9", Href = "/providers", IconName = IconName.PersonPlusFill, Text = "Proveedores"},
new NavItem { Id = "10", Href = "/customers", IconName = IconName.PeopleFill, Text = "Clientes"},
};

            if (userSession.Roles.Any(p => p == UserRoles.Admin))
            {
                navItems = navItems.Append(new NavItem { Id = "11", IconName = IconName.GearFill, Text = "Configuraciones" });
                navItems = navItems.Append(new NavItem
                    {
                        Id = "12",
                        Href = "/users",
                        IconName = IconName.FilePersonFill,
                        Text =
                    "Usuarios",
                        ParentId = "11"
                    });
                navItems = navItems.Append(new NavItem
                    {
                        Id = "13",
                        Href = "/company-administration",
                        IconName =
                    IconName.BuildingFillGear,
                        Text = "Compañía",
                        ParentId = "11"
                    });
            }
        }

        return navItems;
    }
}
